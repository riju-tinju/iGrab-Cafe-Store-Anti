<!-- Sort Modal Styles -->
<style>
    /* Sort Modal Styles */
    .sort-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: flex-end;
        align-items: flex-end;
        z-index: 1000;
    }

    .sort-content {
        background-color: white;
        border-radius: 20px 20px 0 0;
        width: 100%;
        height: auto;
        max-height: 80vh;
        padding: 20px;
        animation: slideUp 0.3s ease;
        display: flex;
        flex-direction: column;
    }

    .sort-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
        margin-bottom: 15px;
        color: black;
    }

    .sort-options {
        overflow-y: auto;
        padding: 10px 0;
    }

    .close-sort {
        background: none;
        border: none;
        cursor: pointer;
        color: #333;
    }

    @keyframes slideUp {
        from {
            transform: translateY(100%);
        }

        to {
            transform: translateY(0);
        }
    }

    /* Desktop Styles */
    @media (min-width: 768px) {

        .modal-content,
        .sort-content {
            width: 450px;
            max-width: 90%;
            border-radius: 20px;
            margin: 40px;
            height: auto;
            max-height: 80vh;
        }


    }
</style>
<!-- Sort Modal (Bottom Sheet) - Hidden by default -->
<div class="sort-modal" dir="rtl">
    <div class="sort-content">
        <div class="sort-header">
            <h2 class="text-xl font-bold">ترتيب المنتجات</h2>
            <button id="close-sort" class="close-sort">
                <i class="mdi mdi-close text-xl"></i>
            </button>
        </div>

        <div class="sort-options">
            <form id="sort-form" method="post">
                <!-- Sort Option 1 -->
                <div class="flex items-center py-3 border-b border-gray-100">
                    <input type="radio" id="new" name="sort" value="new" class="h-4 w-4 text-primary">
                    <label for="new" class="mr-3 text-gray-800">الأحدث</label>
                </div>

                <!-- Sort Option 2 -->
                <div class="flex items-center py-3 border-b border-gray-100">
                    <input type="radio" id="price-high" name="sort" value="price-high" class="h-4 w-4 text-primary">
                    <label for="price-high" class="mr-3 text-gray-800">السعر: من الأعلى للأقل</label>
                </div>

                <!-- Sort Option 3 -->
                <div class="flex items-center py-3 border-b border-gray-100">
                    <input type="radio" id="price-low" name="sort" value="price-low" class="h-4 w-4 text-primary">
                    <label for="price-low" class="mr-3 text-gray-800">السعر: من الأقل للأعلى</label>
                </div>

                <!-- Sort Option 4 -->
                <div class="flex items-center py-3 border-b border-gray-100">
                    <input type="radio" id="name-az" name="sort" value="name-az" class="h-4 w-4 text-primary">
                    <label for="name-az" class="mr-3 text-gray-800">الاسم: أ - ي</label>
                </div>

                <!-- Sort Option 5 -->
                <div class="flex items-center py-3 border-b border-gray-100">
                    <input type="radio" id="name-za" name="sort" value="name-za" class="h-4 w-4 text-primary">
                    <label for="name-za" class="mr-3 text-gray-800">الاسم: ي - أ</label>
                </div>

                <!-- Apply Button -->
                <button type="button" id="apply-sort" class="w-full mt-6 py-3 text-white rounded-lg font-bold"
                    style="background-color: var(--primary-green);">تطبيق</button>
            </form>
        </div>
    </div>
</div>

<script>

    let selectedSortValue = optionSelections.sort; // Track the selected sort value

    // Get DOM elements
    const sortBtn = document.getElementById('sort-btn');
    const sortModal = document.querySelector('.sort-modal');
    const closeSortBtn = document.getElementById('close-sort');
    const modalOverlay = document.getElementById('modal-overlay');
    const applySortBtn = document.getElementById('apply-sort');
    const sortForm = document.getElementById('sort-form');

    // Function to open sort modal
    function openSortModal() {
        console.log('Opening modal, current sort:', optionSelections.sort);
        sortModal.style.display = 'flex';

        if (modalOverlay) {
            modalOverlay.style.opacity = '0.5';
            modalOverlay.style.pointerEvents = 'auto';
        }

        document.body.style.overflow = 'hidden';

        // Pre-select current sort option
        const currentSort = optionSelections.sort;
        const sortInput = document.querySelector(`input[name="sort"][value="${currentSort}"]`);
        if (sortInput) {
            sortInput.checked = true;
            selectedSortValue = currentSort;
        } else {
            document.querySelectorAll('input[name="sort"]').forEach(input => {
                input.checked = false;
            });
            selectedSortValue = 'NOTHING';
        }
    }

    // Function to close sort modal
    function closeSortModal() {
        sortModal.style.display = 'none';
        if (modalOverlay) {
            modalOverlay.style.opacity = '0';
            modalOverlay.style.pointerEvents = 'none';
        }
        document.body.style.overflow = '';
    }

    // Update selectedSortValue on change of any sort input
    document.querySelectorAll('input[name="sort"]').forEach(input => {
        input.addEventListener('change', function () {
            selectedSortValue = this.value;
            console.log('Sort option selected:', selectedSortValue);
        });
    });

    // Apply button click handler
    applySortBtn?.addEventListener('click', function () {
        console.log('Applying sort:', selectedSortValue);

        optionSelections.sort = selectedSortValue || 'NOTHING';
        optionSelections.page = 1;

        console.log('Updated options:', optionSelections);
        // alert('Current sort value: ' + optionSelections.sort);
        updateFilterStatus(optionSelections)
        closeSortModal();
        getProducts(optionSelections);
        sortProducts(optionSelections.sort);
    });

    // Prevent form submission
    sortForm?.addEventListener('submit', function (e) {
        e.preventDefault();
    });

    // Close modal on Escape key
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && sortModal.style.display === 'flex') {
            closeSortModal();
        }
    });

    // Dummy sorting function for now
    function sortProducts(sortBy) {
        console.log('Executing sort with:', sortBy);
        console.log('Current optionSelections:', optionSelections);

        // Example delay to show sort value remains
        setTimeout(() => {
            console.log('Value after 1 second:', optionSelections.sort);
        }, 1000);

        // You can place actual sorting or fetch logic here
    }

    // Event listeners
    sortBtn?.addEventListener('click', openSortModal);
    closeSortBtn?.addEventListener('click', closeSortModal);
    modalOverlay?.addEventListener('click', closeSortModal);
</script>