<%- include('./partials/Header') %>
  <!-- Main Content -->
  <main class="main-container mt-20 lg:mt-24 pb-20 lg:pb-10 px-4 lg:px-8">
    <!-- Hero Banner Slider -->
    <!-- <section class="hero-slider mb-8 lg:mb-12">
      <div class="slide active" style="background: var(--primary-green)"> -->
    <!-- background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url('https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80'); -->
    <!-- <div class="slide-content">
          <h2 class="text-3xl lg:text-4xl font-bold mb-2">iGrab Story Cafe</h2>
          <p class="mb-4">First emirati brand supports Home business of sweets and speciality coffee </p>
          <button class="btn-secondary" style="padding-right:40px ;padding-left: 40px;">View Profile</button>
        </div>
      </div>
      <div class="slide" style="background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url('https://images.unsplash.com/photo-1453614512568-c4024d13c247?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1332&q=80');">
        <div class="slide-content">
          <h2 class="text-3xl lg:text-4xl font-bold mb-2">Artisan Pastries</h2>
          <p class="mb-4">Freshly baked daily by our master chefs</p>
          <button class="btn-secondary">Explore Menu</button>
        </div>
      </div>
      <div class="slide" style="background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url('https://images.unsplash.com/photo-1559305616-3f99cd43e353?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1074&q=80');">
        <div class="slide-content">
          <h2 class="text-3xl lg:text-4xl font-bold mb-2">Premium Coffee</h2>
          <p class="mb-4">Sourced from sustainable farms worldwide</p>
          <button class="btn-secondary">Learn More</button>
        </div>
      </div>
    </section> -->
    <section class="hero-slider mb-8 lg:mb-12">
      <div class="slide active" style="background: var(--primary-green)">
        <!-- background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url('https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80'); -->
        <div class="slide-content">
          <h2 class="text-3xl lg:text-4xl font-bold mb-2">iGrab Story Cafe</h2>
          <p class="mb-4">First Emirati brand supporting home businesses specializing in artisanal sweets and premium
            specialty coffee</p>
          <a href="/company-profile" class="btn-secondary"
            style="padding-right:40px; padding-left: 40px; display: inline-flex; align-items: center; justify-content: center;">Discover
            Our Story</a>
        </div>
      </div>
      <div class="slide"
        style="background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url('https://images.unsplash.com/photo-1453614512568-c4024d13c247?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1332&q=80');">
        <div class="slide-content">
          <h2 class="text-3xl lg:text-4xl font-bold mb-2">Our Heritage</h2>
          <p class="mb-4">Celebrating UAE's culture of generosity and hospitality through exceptional flavors</p>
          <a href="/company-profile" class="btn-secondary"
            style="display: inline-flex; align-items: center; justify-content: center;">Learn About Us</a>
        </div>
      </div>
      <div class="slide"
        style="background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url('https://images.unsplash.com/photo-1559305616-3f99cd43e353?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1074&q=80');">
        <div class="slide-content">
          <h2 class="text-3xl lg:text-4xl font-bold mb-2">Quality & Excellence</h2>
          <p class="mb-4">Partnering with premium local producers to deliver authentic Emirati experiences</p>
          <a href="/company-profile" class="btn-secondary"
            style="display: inline-flex; align-items: center; justify-content: center;">Explore Our Values</a>
        </div>
      </div>
    </section>

    <!-- Categories Scrollable Section -->
    <!-- <section class="mb-10">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl lg:text-3xl font-bold">Categories</h2>
        <a href="#" class="text-accent font-medium">View All</a>
      </div>
      <div class="flex overflow-x-auto space-x-3 py-2 no-scrollbar">
        <div class="category-pill active">All</div>
        <div class="category-pill">Coffee</div>
        <div class="category-pill">Cold Drinks</div>
        <div class="category-pill">Pastries</div>
        <div class="category-pill">Breakfast</div>
        <div class="category-pill">Lunch</div>
        <div class="category-pill">Merchandise</div>
      </div>
    </section> -->

    <% if (products.length===0) { %>
      <!-- <div class="col-span-4 text-center text-gray-500">
        No products available at the moment.
      </div> -->
      <% }else { %>
        <!-- Popular Products Grid -->
        <section class="mb-12">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl lg:text-3xl font-bold">Popular Right Now</h2>
            <a href="/shop" class="text-accent font-medium">See All</a>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 lg:gap-6">

            <% products.forEach(product=> { %>
              <% let isInWishlist=customer.wishlist.some(item=> item.toString() === product._id.toString()); %>
                <div class="product-card">
                  <div class="relative">
                    <img src="<%= product.images[0] %>" alt="<%= product.name.en %>" class="w-full h-48 object-cover">
                    <button onclick="add_or_remove_product_to_wishlist('<%= product._id %>',this)"
                      class="wishlist-btn absolute top-3 right-3 bg-white p-2 rounded-full shadow-md"
                      btn-product-id="<%= product._id %>">

                      <i class="<%= isInWishlist ? 'fas fa-heart text-accent' : 'far fa-heart text-gray-600' %>"></i>
                      <!-- <i class="far fa-heart text-gray-600"></i> -->
                    </button>
                  </div>
                  <div class="p-4">

                    <% if (product.category && product.category.name && product.category.name.en) { %>
                      <div class="text-sm text-gray-500 mb-1">
                        <%= product.category.name.en %>
                      </div>
                      <% } %>

                        <a href="/product/<%= product.meta.slug %>">
                          <h3 class="font-bold mb-1">
                            <%= product.name.en %>
                          </h3>
                        </a>

                        <!-- Star Rating Section -->
                        <div class="flex items-center mb-3 review-rating-section">
                          <div class="flex text-accent">
                            <% const fullStars=Math.floor(product.sales.starRating); %>
                              <% const halfStar=product.sales.starRating % 1>= 0.5; %>
                                <% const emptyStars=5 - fullStars - (halfStar ? 1 : 0); %>

                                  <% for(let i=0; i < fullStars; i++) { %>
                                    <i class="fas fa-star text-sm"></i>
                                    <% } %>
                                      <% if(halfStar) { %>
                                        <i class="fas fa-star-half-alt text-sm"></i>
                                        <% } %>
                                          <% for(let i=0; i < emptyStars; i++) { %>
                                            <i class="far fa-star text-sm"></i>
                                            <% } %>
                          </div>
                          <span class="text-sm text-gray-500 ml-1">(<%= product.sales.totalReviews %>)</span>
                        </div>

                        <div class="flex items-center justify-between">
                          <span class="font-bold">
                            <%= product.pricing.currency %>
                              <%= product.pricing.price %>
                          </span>
                          <button onclick="AddToCart('<%= product._id %>')" productId="<%= product._id %>"
                            class="add-to-cart bg-primary text-white p-2 rounded-full">
                            <i class="fas fa-plus"></i>
                          </button>
                          <!-- id="addToCartButton" -->
                        </div>
                  </div>
                </div>
                <% }); %>

          </div>
        </section>
        <% } %>

          <script>
            function add_or_remove_product_to_wishlist(productId, wishButton) {
              const wishlistCount = document.getElementById('wishlist-count');
              let count = parseInt(wishlistCount.textContent) || 0;

              fetch('api/add-or-remove-wishlist', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                  productId
                })
              })
                .then(response => {
                  if (!response.ok) {
                    // Handle HTTP errors (400, 404, 500, etc.)
                    return response.json().then(err => {
                      throw new Error(err.error || 'Failed to update wishlist');
                    });
                  }
                  return response.json();
                })
                .then(data => {
                  if (data.status) {
                    const funResult = data.status;
                    switch (funResult) {
                      case 'ADDED':
                        wishButton.innerHTML = '<i class="fas fa-heart text-accent"></i>';
                        count++;
                        showToast('Item added to wishlist!');
                        break;
                      case 'REMOVED':
                        wishButton.innerHTML = '<i class="far fa-heart text-gray-600"></i>';
                        count--;
                        showToast('Item removed from wishlist!');
                        break;
                      default:
                        window.location.href = '/login';
                    }
                    wishlistCount.textContent = count;
                    animateCartBadge();
                  } else if (data.error) {
                    showToast(data.error);
                  }
                })
                .catch(error => {
                  console.error('Wishlist error:', error);
                  showToast(error.message || 'An error occurred while updating wishlist');
                  if (error.message.includes('login') || error.message.includes('User not found')) {
                    window.location.href = '/login';
                  }
                });
            }
          </script>
          <!-- Loyalty Program Section -->
          <section class="mb-12 bg-accent rounded-2xl overflow-hidden">
            <div class="flex flex-col lg:flex-row">
              <div class="p-6 lg:p-10 lg:w-1/2">
                <h2 class="text-2xl lg:text-4xl font-bold mb-4 text-primary">See Our Facts</h2>
                <!-- <p class="mb-6 text-gray-700">Earn points with every purchase and unlock exclusive rewards, free
            items, and special offers.</p> -->
                <ul class="mb-8 space-y-2">
                  <li class="flex items-center"><i class="fas fa-check-circle text-primary mr-2"></i>Built on a
                    community-driven business concept.</li>
                  <li class="flex items-center"><i class="fas fa-check-circle text-primary mr-2"></i>Proud to be the
                    First
                    Emirati Brand for this concept </li>
                  <li class="flex items-center"><i class="fas fa-check-circle text-primary mr-2"></i>Proudly serving our
                    community, with plans to grow.</li>
                  <li class="flex items-center"><i class="fas fa-check-circle text-primary mr-2"></i>Supporting 75
                    families
                    and more</li>
                  <li class="flex items-center"><i class="fas fa-check-circle text-primary mr-2"></i>Have more than 15
                    brands
                    of sweets shops</li>
                  <li class="flex items-center"><i class="fas fa-check-circle text-primary mr-2"></i>Made 3 million
                    sales for
                    the families in one year and half</li>
                  <li class="flex items-center"><i class="fas fa-check-circle text-primary mr-2"></i>Ready for Events
                    participation</li>
                  <li class="flex items-center"><i class="fas fa-check-circle text-primary mr-2"></i>Serving the finest
                    coffee
                    beans from around the world</li>
                  <li class="flex items-center"><i class="fas fa-check-circle text-primary mr-2"></i>Any new branch
                    opens new
                    and more families supports</li>
                  <li class="flex items-center"><i class="fas fa-check-circle text-primary mr-2"></i>Approved and
                    licensed
                    delivery vehicles available.</li>
                </ul>
                <a href="/shop" class="btn-primary"
                  style="display: inline-flex; align-items: center; justify-content: center;">See Our Items</a>
              </div>
              <div class="lg:w-1/2">
                <img src="/assets/static-pages/home-page/fact.jpg" alt="Loyalty Program"
                  class="w-full h-full object-cover">
              </div>
            </div>
          </section>

          <!-- How It Works Section -->
          <section class="mb-12">
            <h2 class="text-2xl lg:text-3xl font-bold mb-8 text-center">How It Works</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
              <!-- Step 1 -->
              <div class="bg-white rounded-xl p-6 text-center">
                <div
                  class="w-16 h-16 bg-primary rounded-full flex items-center justify-center text-white text-2xl mx-auto mb-4">
                  <i class="fas fa-search"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">Browse Menu</h3>
                <p class="text-gray-600">Explore our wide range of coffee, drinks, food and merchandise.</p>
              </div>

              <!-- Step 2 -->
              <div class="bg-white rounded-xl p-6 text-center">
                <div
                  class="w-16 h-16 bg-primary rounded-full flex items-center justify-center text-white text-2xl mx-auto mb-4">
                  <i class="fas fa-shopping-bag"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">Add to Cart</h3>
                <p class="text-gray-600">Select your favorite items and add them to your shopping cart.</p>
              </div>

              <!-- Step 3 -->
              <div class="bg-white rounded-xl p-6 text-center">
                <div
                  class="w-16 h-16 bg-primary rounded-full flex items-center justify-center text-white text-2xl mx-auto mb-4">
                  <i class="fas fa-credit-card"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">Checkout</h3>
                <p class="text-gray-600">Securely pay and choose pickup or delivery options.</p>
              </div>

              <!-- Step 4 -->
              <div class="bg-white rounded-xl p-6 text-center">
                <div
                  class="w-16 h-16 bg-primary rounded-full flex items-center justify-center text-white text-2xl mx-auto mb-4">
                  <i class="fas fa-mug-hot"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">Enjoy!</h3>
                <p class="text-gray-600">Pick up your order or receive it at your doorstep.</p>
              </div>
            </div>
          </section>

          <!-- Testimonials Section -->
          <!-- <section class="mb-12">
            <h2 class="text-2xl lg:text-3xl font-bold mb-8">What Our Customers Say</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
             
              <div class="bg-white rounded-xl p-6 shadow-sm">
                <div class="flex text-accent mb-4">
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                  <i class="fas fa-star"></i>
                </div>
                <p class="mb-4 text-gray-700">"The best coffee in town! Their seasonal specials are always a delight
                  and the app makes ordering so convenient."</p>
                <div class="flex items-center">
                  <div class="w-10 h-10 bg-primary rounded-full mr-3"></div>
                  <div>
                    <h4 class="font-bold">Emma Thompson</h4>
                    <p class="text-sm text-gray-500">Regular Customer</p>
                  </div>
                </div>
              </div>

             
            </div>
          </section> -->

          <!-- Newsletter Section -->
          <section class="bg-primary rounded-2xl p-8 text-white text-center">
            <h2 class="text-2xl lg:text-3xl font-bold mb-4">Stay Connected</h2>
            <p class="mb-6 max-w-lg mx-auto">Subscribe to our newsletter for exclusive offers, new product
              announcements, and coffee brewing tips.</p>
            <div class="flex flex-col md:flex-row max-w-md mx-auto">
              <input type="email" id="newsletter-email" placeholder="Your email address"
                class="px-4 py-3 rounded md:flex-grow focus:outline-none text-black">
              <button id="newsletter-subscribe-btn" class="btn-secondary rounded-r-lg mt-2 md:mt-0">Subscribe</button>
            </div>
          </section>

          <script>
            document.getElementById('newsletter-subscribe-btn').addEventListener('click', async function () {
              const emailInput = document.getElementById('newsletter-email');
              const email = emailInput.value.trim();

              if (!email) {
                showToast('Please enter your email address');
                return;
              }

              // Simple email validation
              const emailRegex = /^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/;
              if (!emailRegex.test(email)) {
                showToast('Please provide a valid email address');
                return;
              }

              try {
                this.disabled = true;
                this.textContent = 'Subscribing...';

                const response = await fetch('/api/subscribe-newsletter', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({ email })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                  showToast(data.userMessage);
                  emailInput.value = '';
                } else {
                  showToast(data.userMessage || 'Something went wrong. Please try again.');
                }
              } catch (error) {
                console.error('Newsletter error:', error);
                showToast('An error occurred. Please try again later.');
              } finally {
                this.disabled = false;
                this.textContent = 'Subscribe';
              }
            });
          </script>
  </main>
  <%- include('./partials/Footer') %>